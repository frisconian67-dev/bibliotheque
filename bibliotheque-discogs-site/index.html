<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Bibliothèque Discogs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0b0d12;
      --text:#e9edf5;
      --muted:#9aa4b2;
      --stroke:rgba(255,255,255,.08);
      --radius: 18px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:radial-gradient(1200px 600px at 20% 0%, #121a2e 0%, var(--bg) 45%), var(--bg);
      color:var(--text);
    }
    header{
      position:sticky; top:0; z-index:10;
      padding:18px 16px 12px;
      background:linear-gradient(to bottom, rgba(11,13,18,.92), rgba(11,13,18,.75));
      backdrop-filter: blur(8px);
      border-bottom:1px solid var(--stroke);
    }
    .main::before{
  content:"";
  position:absolute;
  left:50%;
  top:0;
  bottom:0;
  width:1px;
  background: linear-gradient(to bottom, transparent, rgba(255,255,255,.08), transparent);
  transform: translateX(-50%);
}
.main{
  position: relative;
}

    .topline{ display:flex; align-items:center; gap:12px; margin-bottom:12px; }
    .brand{ font-weight:800; letter-spacing:.2px; }
    .badge{ font-size:12px; color:var(--muted); padding:6px 10px; border:1px solid var(--stroke); border-radius:999px; background:rgba(255,255,255,.03); }
    input{
      width:100%; padding:12px 14px;
      border-radius:14px; border:1px solid var(--stroke);
      background:rgba(255,255,255,.03);
      color:var(--text);
      outline:none;
    }
    input:focus{ border-color:rgba(255,255,255,.18); }

    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));
      gap:14px;
      padding:16px;
      max-width:1200px;
      margin:0 auto;
    }
    .card {
      position: relative;
      border-radius: var(--radius);
      overflow: hidden;
      border: 2px solid #ffffff; /* liseré blanc permanent */
      transition: transform 200ms ease, box-shadow 200ms ease, border-color 200ms ease;
    }
    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 0 25px rgba(255, 211, 107, 0.6); /* surbrillance dorée */
      border-color: #ffd36b; /* bordure dorée au survol */
    }

    .coverWrap{ position:relative; }
    .cover{
      width:100%;
      aspect-ratio:1/1;
      object-fit:cover;
      display:block;
      background: #0e1220;
    }
    .shine{
      position:absolute; inset:0;
      background: radial-gradient(600px 260px at 20% 0%, rgba(255,255,255,.10), transparent 55%);
      pointer-events:none;
    }
    .meta{ padding:12px 12px 14px; text-align:center; }
    .artist {
      display: block;
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 6px;
      color: var(--text);
      text-shadow: 1px 1px 2px rgba(0,0,0,0.6); /* effet léger 3D */
    }
    .separator {
      width: 70px; /* plus long */
      height: 1px; /* plus fin */
      background: #ffd36b; /* doré */
      margin: 8px auto;
      border-radius: 2px;
    }
    .title{
      font-weight:800; font-size:15px; line-height:1.2;
      margin:0 0 6px;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.6); /* effet léger 3D */
    }
    .year {
      display: block;
      margin-top: 6px;
      font-size: 13px;
      color: var(--muted);
    }

    .empty{ color:var(--muted); padding:18px; text-align:center; }

    .stars { font-size:20px; letter-spacing:2px; margin-top:8px; text-align:center; }
    .stars .on { color:#ffd36b; text-shadow: 1px 1px 2px #000; }
    .stars .off { color:rgba(255,255,255,.25); text-shadow: 1px 1px 2px #000; }
  
    .sentinel{
  height: 1px;
  max-width:1200px;
  margin: 0 auto;
}
/* ===== Mobile: rendu plus dense (moins "gros") ===== */
@media (max-width: 600px){

  header{ padding:12px 10px 8px; }
  .topline{ margin-bottom:10px; gap:10px; }
  .brand{ font-size:14px; }
  .badge{ font-size:11px; padding:5px 8px; }

  input{ padding:10px 12px; border-radius:12px; font-size:14px; }

  /* Grille: cartes plus petites */
  .grid{
    gap:10px;
    padding:10px;
    grid-template-columns: repeat(auto-fill, minmax(135px, 1fr));
  }

  .meta{ padding:10px 10px 12px; }

  .artist{
    font-size:13px;
    margin-bottom:4px;
  }

  .separator{ width:54px; margin:6px auto; }

  .title{ font-size:13px; margin:0 0 4px; }
  .year{ font-size:12px; margin-top:4px; }

  .stars{ font-size:16px; margin-top:6px; letter-spacing:1px; }

  /* Liseré un peu moins épais sur mobile */
  .card{ border-width:1px; }
}
#starsFilter{
  width:100%;
  margin-top:8px;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid var(--stroke);
  background:rgba(255,255,255,.03);
  color:var(--text);
}

/* ===== Upgrade texte header (moins "blanc plat") ===== */

/* Halo doux derrière artiste + titre */
.header{
  position: relative;
  overflow: hidden;
}
.header::before{
  content:"";
  position:absolute;
  inset:-60px;
  background:
    radial-gradient(500px 220px at 50% 35%, rgba(255,211,107,.20), transparent 65%),
    radial-gradient(900px 340px at 50% 0%, rgba(120,170,255,.10), transparent 60%);
  filter: blur(8px);
  pointer-events:none;
  z-index:0;
}
.header > *{ position: relative; z-index:1; }

/* Artiste : doré plus "premium" */
.header .artist{
  color: transparent;
  background: linear-gradient(180deg, #ffe39a 0%, #ffd36b 40%, #b87a14 100%);
  -webkit-background-clip: text;
  background-clip: text;
  text-shadow:
    0 0 18px rgba(255,211,107,.25),
    0 8px 22px rgba(0,0,0,.55);
}

/* Titre : blanc -> argenté + micro-contraste */
.header h1{
  color: transparent;
  background: linear-gradient(180deg, #ffffff 0%, #dfe7ff 40%, #a9b4d6 100%);
  -webkit-background-clip: text;
  background-clip: text;

  /* relief */
  text-shadow:
    0 1px 0 rgba(0,0,0,.55),
    0 14px 28px rgba(0,0,0,.60),
    0 0 18px rgba(255,255,255,.12);
}

/* Année un peu plus stylée (subtile) */
.header .year{
  letter-spacing: .12em;
  text-transform: uppercase;
  opacity: .9;
}
.header h1{ letter-spacing: .02em; }
/* Halo doré pulsé pour les albums 5★ */
/* Halo doré pulsé (compatible avec overflow:hidden) */
.card.fiveStars{
  position: relative;
}

.card.fiveStars::after{
  content:"";
  position:absolute;
  inset: 0;                /* reste à l’intérieur, donc pas coupé */
  border-radius: inherit;
  pointer-events:none;

  box-shadow:
    0 0 0 5px rgba(255,211,107,.45) inset,
    0 0 18px rgba(255,211,107,.28) inset,
    0 0 48px rgba(255,211,107,.18) inset;

  opacity:.55;
  animation: goldPulse 1.6s ease-in-out infinite;
}

@keyframes goldPulse{
  0%, 100%{ opacity:.40; }
  50%{ opacity:.95; }

}

  </style>
</head>
<body>
<header>
  <div class="topline">
    <div class="brand">Bibliothèque Discogs</div>
    <div class="badge" id="count">…</div>
  </div>
  <input id="q" placeholder="Rechercher artiste, titre, année…" />
  <select id="starsFilter">
  <option value="">Toutes les notes</option>
  <option value="5">★★★★★</option>
  <option value="4">★★★★☆ et +</option>
  <option value="3">★★★☆☆ et +</option>
  <option value="2">★★☆☆☆ et +</option>
  <option value="1">★☆☆☆☆ et +</option>
</select>

</header>

<div class="grid" id="grid"></div>
<div id="sentinel" class="sentinel"></div>


<script>
  function cleanArtist(name) {
  return String(name).replace(/\s*\(\d+\)$/, '');
}


function starsHtml(n){
  if (n === null || n === undefined || n === "") return ""; // non noté → rien affiché

  const v = Math.max(0, Math.min(5, Number(n)));
  let s = '';
  for (let i = 1; i <= 5; i++){
    s += i <= v
      ? `<span class="on">★</span>`
      : `<span class="off">☆</span>`;
  }
  return `<div class="stars">${s}</div>`;
}


fetch('data/export.json?v=' + Date.now())
  .then(r => r.json())
  .then(data => {
    const items = data.items || [];
    const grid = document.getElementById('grid');
    const q = document.getElementById('q');
    const count = document.getElementById('count');
    count.textContent = `${items.length} albums`;

    function render(list){
      grid.innerHTML = '';
      if (!list.length){
        grid.innerHTML = `<div class="empty">Aucun résultat.</div>`;
        return;
      }
      list.forEach(a => {
        const d = document.createElement('div');
d.className = 'card' + (Number(a.stars) === 5 ? ' fiveStars' : '');

        d.onclick = () => location.href = `album.html?slug=${encodeURIComponent(a.slug)}`;
        d.innerHTML = `
          <div class="coverWrap">
            <img class="cover"
     src="${a.cover_image || ''}"
     alt="${a.titre || ''} - ${a.artiste || ''}"
     loading="lazy"
     decoding="async">


            <div class="shine"></div>
          </div>
          <div class="meta">
            <span class="artist">${a.artiste || ''}</span>
            <div class="separator"></div>
            <p class="title">${a.titre || ''}</p>
            <span class="year">${a.annee ?? ''}</span>
            ${starsHtml(a.stars)}

          </div>`;
        grid.appendChild(d);
      });
    }
const pageSize = 72;
let filtered = items.slice();
let visible = 0;

const sentinel = document.getElementById('sentinel');

function appendNext(){
  const next = filtered.slice(visible, visible + pageSize);
  visible += next.length;

 next.forEach(a => {
  const d = document.createElement('div');
  d.className = 'card' + (parseInt(a.stars, 10) === 5 ? ' fiveStars' : '');

  d.onclick = () => location.href = `album.html?slug=${encodeURIComponent(a.slug)}`;

  const artistClean = cleanArtist(a.artiste || '');

  d.innerHTML = `
    <div class="coverWrap">
      <img class="cover"
           src="${a.cover_image || ''}"
           alt="${a.titre || ''} - ${artistClean}"
           loading="lazy" decoding="async">
      <div class="shine"></div>
    </div>
    <div class="meta">
      <span class="artist">${artistClean}</span>
      <div class="separator"></div>
      <p class="title">${a.titre || ''}</p>
      <span class="year">${a.annee ?? ''}</span>
      ${starsHtml(a.stars)}
    </div>`;
  grid.appendChild(d);
});


  count.textContent = `${filtered.length} albums — affichés ${Math.min(visible, filtered.length)}`;
}

function resetAndRender(){
  grid.innerHTML = '';
  visible = 0;

  if (!filtered.length){
    grid.innerHTML = `<div class="empty">Aucun résultat.</div>`;
    count.textContent = `0 album`;
    return;
  }
  appendNext();
}

const io = new IntersectionObserver((entries) => {
  if (!entries[0].isIntersecting) return;
  if (visible < filtered.length) appendNext();
}, { rootMargin: '800px 0px' });

io.observe(sentinel);

const starsFilter = document.getElementById('starsFilter');

function applyFilters(){
  const text = q.value.trim().toLowerCase();
  const minStars = Number(starsFilter.value || 0);

  filtered = items.filter(a => {
    const okText = !text ||
      (a.artiste || '').toLowerCase().includes(text) ||
      (a.titre || '').toLowerCase().includes(text) ||
      String(a.annee ?? '').includes(text);

    const s = Number(a.stars || 0); // non noté => 0
    const okStars = !minStars || s >= minStars;

    return okText && okStars;
  });

  resetAndRender();
}

q.oninput = applyFilters;
starsFilter.onchange = applyFilters;

  resetAndRender();

  });
</script>
</body>
</html>