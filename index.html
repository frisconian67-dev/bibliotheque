<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>OG Collection</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0b0d12;
      --text:#e9edf5;
      --muted:#9aa4b2;
      --stroke:rgba(255,255,255,.08);
      --radius: 18px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:radial-gradient(1200px 600px at 20% 0%, #121a2e 0%, var(--bg) 45%), var(--bg);
      color:var(--text);
    }
    header{
      position:sticky; top:0; z-index:10;
      padding:18px 16px 12px;
      background:linear-gradient(to bottom, rgba(11,13,18,.92), rgba(11,13,18,.75));
      backdrop-filter: blur(8px);
      border-bottom:1px solid var(--stroke);
    }
    .main::before{
  content:"";
  position:absolute;
  left:50%;
  top:0;
  bottom:0;
  width:1px;
  background: linear-gradient(to bottom, transparent, rgba(255,255,255,.08), transparent);
  transform: translateX(-50%);
}
.main{
  position: relative;
}

    .topline{ display:flex; align-items:center; gap:12px; margin-bottom:12px; }
    .brand{ font-weight:800; letter-spacing:.2px; }
    .badge{ font-size:12px; color:var(--muted); padding:6px 10px; border:1px solid var(--stroke); border-radius:999px; background:rgba(255,255,255,.03); }
    input{
      width:100%; padding:12px 14px;
      border-radius:14px; border:1px solid var(--stroke);
      background:rgba(255,255,255,.03);
      color:var(--text);
      outline:none;
    }
    input:focus{ border-color:rgba(255,255,255,.18); }

    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));
      gap:14px;
      padding:16px;
      max-width:1200px;
      margin:0 auto;
    }
    .card {
      position: relative;
      border-radius: var(--radius);
      overflow: hidden;
      border: 2px solid #ffffff; /* liseré blanc permanent */
      transition: transform 200ms ease, box-shadow 200ms ease, border-color 200ms ease;
    }
    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 0 25px rgba(255, 211, 107, 0.6); /* surbrillance dorée */
      border-color: #ffd36b; /* bordure dorée au survol */
    }

    .coverWrap{ position:relative; }
    .cover{
      width:100%;
      aspect-ratio:1/1;
      object-fit:cover;
      display:block;
      background: #0e1220;
    }
    .shine{
      position:absolute; inset:0;
      background: radial-gradient(600px 260px at 20% 0%, rgba(255,255,255,.10), transparent 55%);
      pointer-events:none;
    }
    .meta{ padding:12px 12px 14px; text-align:center; }
    .artist {
      display: block;
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 6px;
      color: var(--text);
      text-shadow: 1px 1px 2px rgba(0,0,0,0.6); /* effet léger 3D */
    }
    .separator {
      width: 70px; /* plus long */
      height: 1px; /* plus fin */
      background: #ffd36b; /* doré */
      margin: 8px auto;
      border-radius: 2px;
    }
    .title{
      font-weight:800; font-size:15px; line-height:1.2;
      margin:0 0 6px;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.6); /* effet léger 3D */
    }
    .year {
      display: block;
      margin-top: 6px;
      font-size: 13px;
      color: var(--muted);
    }

    .empty{ color:var(--muted); padding:18px; text-align:center; }

    .stars { font-size:20px; letter-spacing:2px; margin-top:8px; text-align:center; }
    .stars .on { color:#ffd36b; text-shadow: 1px 1px 2px #000; }
    .stars .off { color:rgba(255,255,255,.25); text-shadow: 1px 1px 2px #000; }
  
    .sentinel{
  height: 1px;
  max-width:1200px;
  margin: 0 auto;
}
/* ===== Mobile: rendu plus dense (moins "gros") ===== */
@media (max-width: 600px){

  header{ padding:12px 10px 8px; }
  .topline{ margin-bottom:10px; gap:10px; }
  .brand{ font-size:14px; }
  .badge{ font-size:11px; padding:5px 8px; }

  input{ padding:10px 12px; border-radius:12px; font-size:14px; }

  /* Grille: cartes plus petites */
  .grid{
    gap:10px;
    padding:10px;
    grid-template-columns: repeat(auto-fill, minmax(135px, 1fr));
  }

  .meta{ padding:10px 10px 12px; }

  .artist{
    font-size:13px;
    margin-bottom:4px;
  }

  .separator{ width:54px; margin:6px auto; }

  .title{ font-size:13px; margin:0 0 4px; }
  .year{ font-size:12px; margin-top:4px; }

  .stars{ font-size:16px; margin-top:6px; letter-spacing:1px; }

  /* Liseré un peu moins épais sur mobile */
  .card{ border-width:1px; }
}
#starsFilter{
  width:100%;
  margin-top:8px;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid var(--stroke);
  background:rgba(255,255,255,.03);
  color:var(--text);
}

/* ===== Upgrade texte header (moins "blanc plat") ===== */

/* Halo doux derrière artiste + titre */
.header{
  position: relative;
  overflow: hidden;
}
.header::before{
  content:"";
  position:absolute;
  inset:-60px;
  background:
    radial-gradient(500px 220px at 50% 35%, rgba(255,211,107,.20), transparent 65%),
    radial-gradient(900px 340px at 50% 0%, rgba(120,170,255,.10), transparent 60%);
  filter: blur(8px);
  pointer-events:none;
  z-index:0;
}
.header > *{ position: relative; z-index:1; }

/* Artiste : doré plus "premium" */
.header .artist{
  color: transparent;
  background: linear-gradient(180deg, #ffe39a 0%, #ffd36b 40%, #b87a14 100%);
  -webkit-background-clip: text;
  background-clip: text;
  text-shadow:
    0 0 18px rgba(255,211,107,.25),
    0 8px 22px rgba(0,0,0,.55);
}

/* Titre : blanc -> argenté + micro-contraste */
.header h1{
  color: transparent;
  background: linear-gradient(180deg, #ffffff 0%, #dfe7ff 40%, #a9b4d6 100%);
  -webkit-background-clip: text;
  background-clip: text;

  /* relief */
  text-shadow:
    0 1px 0 rgba(0,0,0,.55),
    0 14px 28px rgba(0,0,0,.60),
    0 0 18px rgba(255,255,255,.12);
}

/* Année un peu plus stylée (subtile) */
.header .year{
  letter-spacing: .12em;
  text-transform: uppercase;
  opacity: .9;
}
.header h1{ letter-spacing: .02em; }
/* Halo doré pulsé pour les albums 5★ */
/* Halo doré pulsé (compatible avec overflow:hidden) */
.card.fiveStars{
  position: relative;
}

.card.fiveStars::after{
  content:"";
  position:absolute;
  inset: 0;                /* reste à l’intérieur, donc pas coupé */
  border-radius: inherit;
  pointer-events:none;

  box-shadow:
    0 0 0 5px rgba(255,211,107,.45) inset,
    0 0 18px rgba(255,211,107,.28) inset,
    0 0 48px rgba(255,211,107,.18) inset;

  opacity:.55;
  animation: goldPulse 1.6s ease-in-out infinite;
}

@keyframes goldPulse{
  0%, 100%{ opacity:.40; }
  50%{ opacity:.95; }

}
@media (hover: hover){

  .title{
    transition: color .15s ease, text-shadow .15s ease;
  }

  .title:hover{
    color: #cfd6ff;
    text-shadow: 0 0 8px rgba(143,162,255,.25);
  }

  .artistLink{
    transition: color .15s ease;
  }

  .artistLink:hover{
    color: var(--text);
  }

}
.title{
  font-weight: 600;
  letter-spacing: .2px;
}
.artistLink,
.artist{
  color: var(--muted);
  font-weight: 400;
}
.year{
  font-variant-numeric: tabular-nums;
  opacity: .75;
}
@media (hover: hover){

  .title{
    transition: color .15s ease, text-shadow .15s ease;
  }

  .title:hover{
    color: #cfd6ff;
    text-shadow: 0 0 8px rgba(143,162,255,.25);
  }

  .artistLink{
    transition: color .15s ease;
  }

  .artistLink:hover{
    color: var(--text);
  }

}
select option{
  background: #0b0b0f;
  color: rgba(255,255,255,.45);
}

select option:checked{
  color: rgba(255,211,107,.95);
  font-weight: 600;
}

select option:hover{
  color: rgba(255,255,255,.85);
}
select option{
  font-family: 'Montserrat', system-ui, sans-serif;
  letter-spacing: 1px;
}
/* ===== Filtre étoiles : rendu doré lisible ===== */
#starsFilter {
  color: #ffd36b;
  font-weight: 600;
}

/* Options (menu déroulé) */
#starsFilter option {
  color: #ffd36b;
  background-color: #0b0d12;
}

/* Option ALL un peu plus neutre */
#starsFilter option[value="all"] {
  color: #e9edf5;
}
#starsFilter option {
  color: #ffd36b;
  background-color: #0b0d12;
}

/* Le caractère ☆ est naturellement plus fin → suffisant */
#starsFilter {
  letter-spacing: 2px;
}
/* Dropdown étoiles (custom) */
.starsSelect{ margin-top:8px; position:relative; }

.starsSelectBtn{
  width:100%;
  display:flex; align-items:center; justify-content:space-between;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid var(--stroke);
  background:rgba(255,255,255,.03);
  color:var(--text);
  cursor:pointer;
}

.starsMenu{
  position:absolute; left:0; right:0; top:calc(100% + 8px);
  border-radius:14px;
  border:1px solid var(--stroke);
  background:#0b0b0f;
  box-shadow:0 18px 40px rgba(0,0,0,.55);
  overflow:hidden;
  z-index:20;
}

.starsItem{
  width:100%;
  display:flex; justify-content:flex-start; align-items:center;
  gap:10px;
  padding:10px 12px;
  border:0;
  background:transparent;
  color:var(--text);
  cursor:pointer;
}

.starsItem:hover{ background:rgba(255,255,255,.06); }

.starsItem .stars{
  margin:0;           /* reprend ton rendu */
  font-size:18px;
  letter-spacing:2px;
}

/* libellés ALL / Non noté */
.starsItem .lbl{ color:rgba(255,255,255,.85); font-size:13px; }

  </style>
</head>
<body>
<header>
  <div class="topline">
    <div class="brand">OG collection</div>
    <div class="badge" id="count">…</div>
  </div>
  <input id="q" placeholder="Rechercher artiste, titre, année…" />
  <div class="starsSelect" id="starsSelect">
  <button class="starsSelectBtn" id="starsSelectBtn" type="button">
    <span class="lbl">ALL — toutes les notes</span>
    <span class="chev">▾</span>
  </button>

  <div class="starsMenu" id="starsMenu" hidden>
    <button type="button" class="starsItem" data-value="">
      <span class="lbl">ALL — toutes les notes</span>
    </button>

    <button type="button" class="starsItem" data-value="5">${starsHtml(5)}</button>
    <button type="button" class="starsItem" data-value="4">${starsHtml(4)}</button>
    <button type="button" class="starsItem" data-value="3">${starsHtml(3)}</button>
    <button type="button" class="starsItem" data-value="2">${starsHtml(2)}</button>
    <button type="button" class="starsItem" data-value="1">${starsHtml(1)}</button>

    <button type="button" class="starsItem" data-value="null">
      <span class="lbl">Non noté</span>
    </button>
  </div>
</div>




</header>

<div class="grid" id="grid"></div>
<div id="sentinel" class="sentinel"></div>


<script>
  function cleanArtist(name) {
  return String(name).replace(/\s*\(\d+\)$/, '');
}


function starsHtml(n){
  if (n === null || n === undefined || n === "") return ""; // non noté → rien affiché

  const v = Math.max(0, Math.min(5, Number(n)));
  let s = '';
  for (let i = 1; i <= 5; i++){
    s += i <= v
      ? `<span class="on">★</span>`
      : `<span class="off">☆</span>`;
  }
  return `<div class="stars">${s}</div>`;
}


fetch('data/export.json?v=' + Date.now())
  .then(r => r.json())
  .then(data => {
    const items = data.items || [];
    const grid = document.getElementById('grid');
    const q = document.getElementById('q');
    let starsValue = ""; // "" = ALL | "1".."5" | "null" (non noté)

    const count = document.getElementById('count');
    count.textContent = `${items.length} albums`;

    function render(list){
      grid.innerHTML = '';
      if (!list.length){
        grid.innerHTML = `<div class="empty">Aucun résultat.</div>`;
        return;
      }
      list.forEach(a => {
        const d = document.createElement('div');
d.className = 'card' + (Number(a.stars) === 5 ? ' fiveStars' : '');

        d.onclick = () => location.href = `album.html?slug=${encodeURIComponent(a.slug)}`;
        d.innerHTML = `
          <div class="coverWrap">
            <img class="cover"
     src="covers/${a.release_id}.jpg"
     alt="${a.titre || ''} - ${a.artiste || ''}"
     loading="lazy"
     decoding="async"
     onerror="this.style.display='none'">



            <div class="shine"></div>
          </div>
          <div class="meta">
            <span class="artist">${a.artiste || ''}</span>
            <div class="separator"></div>
            <p class="title">${a.titre || ''}</p>
            <span class="year">${a.annee ?? ''}</span>
            ${starsHtml(a.stars)}

          </div>`;
        grid.appendChild(d);
      });
    }
const pageSize = 72;
let filtered = items.slice();
let visible = 0;

const sentinel = document.getElementById('sentinel');

function appendNext(){
  const next = filtered.slice(visible, visible + pageSize);
  visible += next.length;

 next.forEach(a => {
  const d = document.createElement('div');
  d.className = 'card' + (parseInt(a.stars, 10) === 5 ? ' fiveStars' : '');

  d.onclick = () => location.href = `album.html?slug=${encodeURIComponent(a.slug)}`;

  const artistClean = cleanArtist(a.artiste || '');

  d.innerHTML = `
    <div class="coverWrap">
      <img class="cover"
     src="covers/${a.release_id}.jpg"
     alt="${a.titre || ''} - ${artistClean}"
     loading="lazy" decoding="async"
     onerror="this.style.display='none'">


      <div class="shine"></div>
    </div>
    <div class="meta">
      <span class="artist">${artistClean}</span>
      <div class="separator"></div>
      <p class="title">${a.titre || ''}</p>
      <span class="year">${a.annee ?? ''}</span>
      ${starsHtml(a.stars)}
    </div>`;
  grid.appendChild(d);
});


  count.textContent = `${filtered.length} albums — affichés ${Math.min(visible, filtered.length)}`;
}

function resetAndRender(){
  grid.innerHTML = '';
  visible = 0;

  if (!filtered.length){
    grid.innerHTML = `<div class="empty">Aucun résultat.</div>`;
    count.textContent = `0 album`;
    return;
  }
  appendNext();
}

const io = new IntersectionObserver((entries) => {
  if (!entries[0].isIntersecting) return;
  if (visible < filtered.length) appendNext();
}, { rootMargin: '800px 0px' });

io.observe(sentinel);



function applyFilters(){
  const text = q.value.trim().toLowerCase();

  filtered = items.filter(a => {
    const okText =
      !text ||
      (a.artiste || '').toLowerCase().includes(text) ||
      (a.titre || '').toLowerCase().includes(text) ||
      String(a.annee ?? '').includes(text);

    const okStars =
      (starsValue === "") || // ALL
      (starsValue === "null" && (a.stars === null || a.stars === undefined || a.stars === "")) ||
      (Number(a.stars) === Number(starsValue));

    return okText && okStars;
  });

  resetAndRender();

}
q.addEventListener('input', applyFilters);
// Remplit les boutons 1..5 avec le rendu ★ doré / ☆ grisé
document.querySelectorAll('.starsItem[data-value]').forEach(btn => {
  const v = btn.dataset.value;
  if (v && v !== "null") btn.innerHTML = starsHtml(Number(v));
});

// Ouvre/ferme
const starsSelectBtn = document.getElementById('starsSelectBtn');
const starsMenu = document.getElementById('starsMenu');

starsSelectBtn.addEventListener('click', () => {
  starsMenu.toggleAttribute('hidden');
});

// Choix d’une valeur
starsMenu.addEventListener('click', (e) => {
  const b = e.target.closest('.starsItem');
  if (!b) return;

  starsValue = b.dataset.value ?? "";

  // libellé du bouton
  const lbl = starsSelectBtn.querySelector('.lbl');
  if (starsValue === "") lbl.textContent = "ALL — toutes les notes";
  else if (starsValue === "null") lbl.textContent = "Non noté";
  else lbl.innerHTML = starsHtml(Number(starsValue));

  starsMenu.setAttribute('hidden', '');
  applyFilters();
});

// click dehors = ferme
document.addEventListener('click', (e) => {
  if (e.target.closest('#starsSelect')) return;
  starsMenu.setAttribute('hidden', '');
});


  });
</script>
</body>
</html>