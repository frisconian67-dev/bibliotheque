<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Album</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --muted: #aaa;
    }
    body {
      font-family: 'Montserrat', sans-serif;
      text-align: center;
      margin: 2rem;
      background: #000;
      color: #eee;
    }
    img.cover {
      width: 400px;
      aspect-ratio: 1/1;
      object-fit: cover;
      border-radius: 14px;
      border: 2px solid rgba(255,255,255,.2);
      display: block;
      margin: 0 auto 2rem auto;
      box-shadow: 0 0 30px rgba(255,255,255,0.4);
      animation: pulseGlow 4s infinite alternate;
    }
    @keyframes pulseGlow {
      from { box-shadow: 0 0 20px rgba(255,255,255,0.3); }
      to   { box-shadow: 0 0 50px rgba(255,255,255,0.7); }
    }
    h1 {
      margin: 1rem 0;
      font-size: 2.8rem;
      text-shadow: 0 0 12px rgba(255,255,255,0.6);
    }
    .artist {
      font-family: 'Orbitron', sans-serif;
      font-size: 2.2rem;
      margin: 1rem 0;
      letter-spacing: 2px;
      text-transform: uppercase;
      text-shadow: 0 0 18px rgba(255,215,0,0.7);
    }
    .year {
      font-size: 1.6rem;
      margin: 1rem 0;
      opacity: 0.85;
    }
    .separator {
      width: 60%;
      height: 1px;
      background: linear-gradient(to right, transparent, #555, transparent);
      margin: 1.5rem auto;
    }
    /* Tracklist styles */
    .tracklist {
      max-width:640px;
      margin:24px auto 0;
      text-align:left;
      background: linear-gradient(145deg, #111, #222);
      border-radius: 20px;
      padding: 1.5rem;
      box-shadow: 8px 8px 20px #000, -8px -8px 20px #333;
      animation: floatBox 6s infinite alternate;
    }
    @keyframes floatBox {
      from { transform: perspective(600px) rotateX(2deg) translateY(0); }
      to   { transform: perspective(600px) rotateX(-2deg) translateY(-10px); }
    }
    .tracklist h3 {
      text-align:center;
      margin:0 0 10px;
      font-size:14px;
      color:var(--muted);
      letter-spacing:.3px;
      text-transform:uppercase;
    }
    ol.tracks {
      padding-left:0;
      list-style:none;
      margin:0;
    }
    .track {
      display:flex;
      justify-content:space-between;
      gap:10px;
      padding:10px 12px;
      border-top:1px solid rgba(255,255,255,.08);
      border-radius:12px;
      background:rgba(255,255,255,.02);
      transition: all 0.3s ease;
    }
    .track:first-child{ border-top:none; }
    .track:hover {
      background: rgba(255,255,255,.08);
      box-shadow: 0 0 12px rgba(255,215,0,0.4);
      transform: translateY(-2px);
    }
    .tleft{ display:flex; gap:10px; align-items:baseline; min-width:0; }
    .tno{ color:var(--muted); min-width:28px; text-align:right; }
    .tname{
      font-weight:700;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      max-width:520px;
    }
    .tdur{ color:var(--muted); white-space:nowrap; }
    .empty{ color:var(--muted); text-align:center; }
    /* Étoiles design */
    .stars {
      margin-top: 1.5rem;
      font-size: 3.2rem;
    }
    .star {
      color: transparent;
      -webkit-text-stroke: 2px black;
      background: linear-gradient(to top, gold, #fff);
      -webkit-background-clip: text;
      background-clip: text;
      text-shadow: 0 0 15px rgba(255,215,0,0.8);
      animation: twinkle 2s infinite alternate;
    }
    .tracklist {
  max-width: 640px;
  margin: 24px auto;
  text-align: left;
}

.tracklist h3 {
  font-size: 18px;
  font-weight: bold;
  color: var(--muted);
  margin-bottom: 10px;
}

ol.tracks {
  list-style: none;
  padding-left: 0;
}

.track {
  display: flex;
  justify-content: space-between;
  gap: 10px;
  padding: 10px 12px;
  border-top: 1px solid rgba(255, 255, 255, .08);
  background: rgba(255, 255, 255, .02);
  border-radius: 10px;
}

.track:first-child {
  border-top: none;
}

.tleft {
  display: flex;
  gap: 10px;
  align-items: baseline;
  min-width: 0;
}

.tno {
  color: var(--muted);
  font-variant-numeric: tabular-nums;
  min-width: 28px;
  text-align: right;
}

.tname {
  font-weight: 700;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  max-width: 500px;
}

.tdur {
  color: var(--muted);
  font-variant-numeric: tabular-nums;
  white-space: nowrap;
}

    @keyframes twinkle {
      from { opacity: 0.7; text-shadow: 0 0 10px rgba(255,215,0,0.5); }
      to   { opacity: 1; text-shadow: 0 0 20px rgba(255,215,0,1); }
    }
  </style>
</head>

<body>
  <div id="app"></div>

  <script>
    function escapeHtml(s){
      return String(s ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function stars(n){
      n = Math.max(0, Math.min(5, Number(n) || 0));
      let s = "";
      for(let i=1;i<=5;i++){
        s += `<span class="star">${i<=n ? "★" : "☆"}</span>`;
      }
      return `<div class="stars">${s}</div>`;
    }

    // Fonction de rendu de la tracklist
    function renderTracklist(tracklist) {
  if (!tracklist || !tracklist.length) {
    return `<div class="empty">Tracklist non disponible.</div>`;
  }

  // Normalisation des données pour être sûr qu'elles ont un format correct
  const norm = tracklist.map((t, i) => ({
    pos: t.pos ?? (i + 1),
    title: t.title ?? t.name ?? "Titre inconnu",
    dur: t.dur ?? t.duration ?? "Durée inconnue"
  }));

  return `
    <div class="tracklist">
      <h3>Tracklist</h3>
      <ol class="tracks">
        ${norm.map(t => `
          <li class="track">
            <div class="tleft">
              <div class="tno">${t.pos}</div>
              <div class="tname">${escapeHtml(t.title)}</div>
            </div>
            <div class="tdur">${escapeHtml(t.dur)}</div>
          </li>
        `).join('')}
      </ol>
    </div>
  `;
}


    window.addEventListener("DOMContentLoaded", () => {
      const app = document.getElementById("app");
      const slug = new URLSearchParams(location.search).get("slug");

      if (!slug) {
        app.innerHTML = `Ouvre un album depuis l’index.`;
        return;
      }

      fetch("data/export.json")
        .then(r => r.json())
        .then(data => {
          const items = data.items || [];
          const a = items.find(x => x.slug === slug);

          if (!a) {
            app.innerHTML = `Album introuvable.`;
            return;
          }

          const cover = a.cover_image || "";

          app.innerHTML = `
            ${cover ? `<img class="cover" src="${escapeHtml(cover)}" alt="Pochette de ${escapeHtml(a.titre)}">` : `<div>Pas de pochette</div>`}
            <div class="artist">${escapeHtml(a.artiste || "Artiste inconnu")}</div>
            <div class="separator"></div>
            <h1>${escapeHtml(a.titre || "Titre inconnu")}</h1>
            <div class="separator"></div>
            <div class="year">${escapeHtml(a.annee ? String(a.annee) : "Année inconnue")}</div>
            <div class="separator"></div>
            ${stars(a.stars ?? 0)}
            ${renderTracklist(a.tracklist)}
          `;
        });
    });
  </script>
</body>
</html>